var roulette=angular.module("roulette",[]);
roulette.directive("phRoulette",["$interval",function(l){return{restrict:"A",replace:!1,transclude:!1,scope:{},link:function(a,b,c){a.config=a.$eval(c.phRoulette);if(angular.isObject(a.config)&&0!==Object.keys(a.config).length){a.useBgImage=angular.isObject(a.config.bgImage)&&0<Object.keys(a.config.bgImage).length;a.titleBoxSelector="titleBox_"+a.$id;angular.element(b).addClass("roulette-container");var p=2*Math.PI;c="ci"+a.$id;var k=a.config.thumb.width,h=a.config.thumb.height,e=b.children(),m;a.imageCount=
e.length;a.angleIncrement=a.config.angleStep*Math.PI/180;a.angle=0;a.run=!0;a.currentTitle="";a.canvasWidth=angular.element(b).width();a.canvasHeight=angular.element(b).height();a.center={x:a.canvasWidth/2,y:a.canvasHeight/2};if(0<a.imageCount){a.angleStep=2*Math.PI/a.imageCount;angular.element(e).each(function(){var j=angular.element(this).children("img").attr("title"),b=angular.element(this).attr("href");angular.element(this).css({width:k,height:h,padding:0,margin:0});angular.element(this).children("img").css({width:k,
height:h});angular.element(this).on("mouseenter",function(){a.setTitleBox(j,b)})});a.setTitleBox=function(j,b){angular.element(a.titleBox).css("display","none");angular.element(a.titleBox).html("<span>"+j+"</span>");angular.element(a.titleBox).attr("href",b);angular.element(a.titleBox).fadeIn(500);a.currentTitle=j};b.on("$destroy",function(){l.cancel(m)});angular.element(b).on("mouseenter",function(){a.run=!1});angular.element(b).on("mouseleave",function(){a.run=!0});m=l(function(){if(a.run)for(var b=
0;b<a.imageCount;b++){var c=angular.element(e[b]).children("img").first().attr("title"),d=angular.element(e[b]).attr("href"),g=a.angle+b*a.angleStep,f=a.center.x+(a.config.radius*Math.cos(g)-k/2),g=a.center.y-(a.config.radius*Math.sin(g)+h/2);5>=Math.abs(a.center.y-(g+h/2))&&f>a.center.x&&c!=a.currentTitle&&a.setTitleBox(c,d);angular.element(e[b]).css("left",f+"px");angular.element(e[b]).css("top",g+"px");a.useBgImage&&(a.bgImage.style.transform="rotate("+a.angle+"rad)");a.angle="ccw"===a.config.rotation?
a.angle+a.angleIncrement:a.angle-a.angleIncrement;a.angle%=p}},a.config.delay);var d=angular.element('<a class="titleBox" id="'+a.titleBoxSelector+'"></a>');angular.element(d).children("img").first().attr("src",angular.element(e[0]).children("img").first().attr("src"));var f=0.75*a.config.radius,n=0.5*a.config.radius;angular.element(d).css({width:f,height:n,left:a.center.x-f/2,top:a.center.y-n/2});angular.element(b).append(d);a.titleBox=d[0];a.useBgImage&&(c=angular.element('<img id="'+c+'" class="bgImage"/>'),
d=a.center.x-a.config.bgImage.width/2,f=a.center.y-a.config.bgImage.height/2,angular.element(c).css({left:d,top:f,width:a.config.bgImage.width,height:a.config.bgImage.height}),angular.element(c).attr("src",a.config.bgImage.src),angular.element(b).append(c),a.bgImage=c[0])}}}}}]);
